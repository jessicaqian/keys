{% extends "base.html" %}

{% load static %}

{% block title %}编辑配置模板{% endblock %}

{% block css %}
<link href="{% static  "system/css/newtemp.css" %}" rel="stylesheet">
{% endblock %}

{% block content %}
<div class="row sparse"><label class="head">编辑配置模板&nbsp&nbsp&nbsp&nbsp</label></div>

    {% csrf_token %}

<div class="row sparse_min">
    <div class="col-md-5 ">
        <label>模板名称:&nbsp&nbsp</label>{{ name }}
    </div>
    <div class="col-md-7">
            <input type="text" placeholder="按名称关键字搜索" id="search_info">
            <button class="btn btn-primary" id="search_button">
            <span class="glyphicon glyphicon-search" aria-hidden="true"></span> 搜索</button>
    </div>

</div>
<div class="row sparse_min" id="key_set">
    <div id="key_table_head">
        <table class="table table-hover table-condensed table-striped" id="key_table">
            <colgroup>
                <col style="width: 150px"><col style="width:7%"><col style="width:7%"><col style="width:7%"><col style="width:7%"><col style="width:7%">
                <col style="width:7%"><col style="width:7%"><col style="width:7%"><col style="width:7%"><col style="width:7%"><col style="width:7%"><col style="width:7%">
            </colgroup>
            <thead>
                <tr>
                    <th>输出名称</th>
                    <th>预设1</th>
                    <th>预设2</th>
                    <th>预设3</th>
                    <th>预设4</th>
                    <th>预设5</th>
                    <th>预设6</th>
                    <th>预设7</th>
                    <th>预设8</th>
                    <th>预设9</th>
                    <th>预设10</th>
                    <th>预设11</th>
                    <th>预设12</th>
                </tr>
            </thead>
        </table>
    </div>
    <div id="key_table_box">
        <table class="table table-hover table-condensed table-striped" id="key_table_body">
            <colgroup>
                <col style="width: 150px"><col style="width:7%"><col style="width:7%"><col style="width:7%"><col style="width:7%"><col style="width:7%">
                <col style="width:7%"><col style="width:7%"><col style="width:7%"><col style="width:7%"><col style="width:7%"><col style="width:7%"><col style="width:7%">
            </colgroup>
            <tbody>
            {% for name in output_name %}
                <tr id="id{{ forloop.counter }}" >
                    <td id="name_{{ forloop.counter }}">{{ name.0 }}</td>
                    <td><input name="key1" type="checkbox" value="{{ name.0 }}" /></td>
                    <td><input name="key2" type="checkbox" value="{{ name.0 }}" /></td>
                    <td><input name="key3" type="checkbox" value="{{ name.0 }}" /></td>
                    <td><input name="key4" type="checkbox" value="{{ name.0 }}" /></td>
                    <td><input name="key5" type="checkbox" value="{{ name.0 }}" /></td>
                    <td><input name="key6" type="checkbox" value="{{ name.0 }}" /></td>
                    <td><input name="key7" type="checkbox" value="{{ name.0 }}" /></td>
                    <td><input name="key8" type="checkbox" value="{{ name.0 }}" /></td>
                    <td><input name="key9" type="checkbox" value="{{ name.0 }}" /></td>
                    <td><input name="key10" type="checkbox" value="{{ name.0 }}" /></td>
                    <td><input name="key11" type="checkbox" value="{{ name.0 }}" /></td>
                    <td><input name="key12" type="checkbox" value="{{ name.0 }}" /></td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
    <div id="key_table_action">
        <table class="table table-hover table-condensed" id="delete_action">
            <colgroup>
                <col style="width: 150px"><col style="width:7%"><col style="width:7%"><col style="width:7%"><col style="width:7%"><col style="width:7%">
                <col style="width:7%"><col style="width:7%"><col style="width:7%"><col style="width:7%"><col style="width:7%"><col style="width:7%"><col style="width:7%">
            </colgroup>
            <tbody>
                <tr >
                    <td><label class="action" >清除此按键设置</label></td>
                    <td>
                        <a class="btn config" id="key1">
                            <span class="glyphicon glyphicon-trash" aria-hidden="true"></span>
                        </a>
                    </td>
                    <td>
                        <a class="btn config" id="key2">
                            <span class="glyphicon glyphicon-trash" aria-hidden="true"></span>
                        </a>
                    </td>
                    <td>
                        <a class="btn config" id="key3">
                            <span class="glyphicon glyphicon-trash" aria-hidden="true"></span>
                        </a>
                    </td>
                    <td>
                        <a class="btn config" id="key4">
                            <span class="glyphicon glyphicon-trash" aria-hidden="true"></span>
                        </a>
                    </td>
                    <td>
                        <a class="btn config" id="key5">
                            <span class="glyphicon glyphicon-trash" aria-hidden="true"></span>
                        </a>
                    </td>
                    <td>
                        <a class="btn config" id="key6">
                            <span class="glyphicon glyphicon-trash" aria-hidden="true"></span>
                        </a>
                    </td>
                    <td>
                        <a class="btn config" id="key7">
                            <span class="glyphicon glyphicon-trash" aria-hidden="true"></span>
                        </a>
                    </td>
                    <td>
                        <a class="btn config" id="key8">
                            <span class="glyphicon glyphicon-trash" aria-hidden="true"></span>
                        </a>
                    </td>
                    <td>
                        <a class="btn config" id="key9">
                            <span class="glyphicon glyphicon-trash" aria-hidden="true"></span>
                        </a>
                    </td>
                    <td>
                        <a class="btn config" id="key10">
                            <span class="glyphicon glyphicon-trash" aria-hidden="true"></span>
                        </a>
                    </td>
                    <td>
                        <a class="btn config" id="key11">
                            <span class="glyphicon glyphicon-trash" aria-hidden="true"></span>
                        </a>
                    </td>
                    <td>
                        <a class="btn config" id="key12">
                            <span class="glyphicon glyphicon-trash" aria-hidden="true"></span>
                        </a>
                    </td>

                </tr>


            </tbody>
        </table>
    </div>
</div>
<div class="col-md-2 col-md-offset-10">
    <button class="btn btn-primary" id="save">
        <span class="glyphicon glyphicon-copy" aria-hidden="true"></span> 保存配置模板
    </button>
</div>



{% endblock %}

{% block js %}
<script type="text/javascript">

{% for key in key1 %}
    $('input[name="key1"][value="{{ key }}"]').attr("checked","checked")
{% endfor %}

{% for key in key2 %}
    $('input[name="key2"][value="{{ key }}"]').attr("checked","checked")
{% endfor %}

{% for key in key3 %}
    $('input[name="key3"][value="{{ key }}"]').attr("checked","checked")
{% endfor %}

{% for key in key4 %}
    $('input[name="key4"][value="{{ key }}"]').attr("checked","checked")
{% endfor %}

{% for key in key5 %}
    $('input[name="key5"][value="{{ key }}"]').attr("checked","checked")
{% endfor %}

{% for key in key6 %}
    $('input[name="key6"][value="{{ key }}"]').attr("checked","checked")
{% endfor %}

{% for key in key7 %}
    $('input[name="key7"][value="{{ key }}"]').attr("checked","checked")
{% endfor %}

{% for key in key8 %}
    $('input[name="key8"][value="{{ key }}"]').attr("checked","checked")
{% endfor %}

{% for key in key9 %}
    $('input[name="key9"][value="{{ key }}"]').attr("checked","checked")
{% endfor %}

{% for key in key10 %}
    $('input[name="key10"][value="{{ key }}"]').attr("checked","checked")
{% endfor %}

{% for key in key11 %}
    $('input[name="key11"][value="{{ key }}"]').attr("checked","checked")
{% endfor %}

{% for key in key12 %}
    $('input[name="key12"][value="{{ key }}"]').attr("checked","checked")
{% endfor %}

    var set_dict = {
        'name':'{{ name }}',
        'key1':[],'key2':[],'key3':[],'key4':[],'key5':[],'key6':[],
        'key7':[],'key8':[],'key9':[],'key10':[],'key11':[],'key12':[],

    }


    $('#search_button').click(function () {
        var text = $('#search_info').val()
        for(i = 1;i<={{output_name|length}};i++){
            var file_name = $('#name_'+ i).text()
            if (file_name.indexOf(text) == -1){
                $('#id'+ i).attr('style','display:none')
            }else {
                var str = '<span style="background-color:#eec805">'+text+'</span>';
                $('#name_'+ i).html($('#name_'+ i).text().replace(text,str));
            }
        }

    })
    $("#search_info").blur(function () {
        var text = $(this).val()
        if(text == ''){
            for(i = 1;i<={{output_name|length}};i++){
                $('#id'+ i).removeAttr('style')
                $('#id_'+ i + '>span').removeAttr('style')
            }
        }
    })


    $('a#flow').attr('aria-expanded','true');
    $('div#collapseExample').attr('class','collapse in');
    $('a.config').click(function () {
        var ele = $(this).attr('id')
        $('input[name="'+ele+'"]').attr('checked',false)
    })
    $('button#save').click(function () {

        for(i=1;i<13;i++){
            var key = "key"+i
            $('input[name="'+key+'"]:checked').each(function(){
                set_dict[key].push($(this).val());//向数组中添加元素
            });
        }


        var jsonStr = JSON.stringify(set_dict);
        $.post("saveTemplate",{'mes':jsonStr,'csrfmiddlewaretoken': $("[name = 'csrfmiddlewaretoken']").val(),'status':'edit'}).done(function () {
            window.location.href ='template.html'

        }).fail(function () {

        })

    })





</script>
{% endblock %}
